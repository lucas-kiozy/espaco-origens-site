---
/**
 * Página de Login (stub para futura integração).
 * - Formulário acessível (email + senha).
 * - Ao enviar, simula login salvando localStorage.auth="1" e userEmail.
 * - Depois redireciona para a home.
 * - Mantém paleta e semântica para SEO.
 * - Compatível com GitHub Pages (prefixo base em assets).
 */

import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Button from '../components/ui/Button.astro';

// Função auxiliar para prefixar a BASE_URL
const asset = (path: string) => `${import.meta.env.BASE_URL}${path.replace(/^\/+/, '')}`;

const meta = {
  title: 'entrar - espaço origens',
  description: 'acesse sua conta em espaço origens para acompanhar pedidos e ver favoritos.',
};
---

<Layout title={meta.title} description={meta.description}>
  <Header />

  <main class="flex items-center justify-center min-h-[calc(85vh-8rem)] px-4 py-12">
    <section class="w-full max-w-md bg-areia/40 border border-areia/70 rounded-2xl shadow-sm p-6">
      <h1 class="text-2xl lowercase text-marrom mb-2">entrar</h1>
      <p class="text-marrom/80 mb-4 text-sm">
        use seu email e senha. quando a loja estiver ativa, você poderá acompanhar pedidos e favoritos.
      </p>

      <!-- formulário de login -->
      <form id="loginForm" novalidate>
        <!-- campo email -->
        <div>
          <label for="email">email</label>
          <input
            id="email" name="email" type="email" required
            placeholder="nome@exemplo.com"
            autocomplete="email"
          />
        </div>

        <!-- campo senha -->
        <div>
          <label for="password">senha</label>
          <input
            id="password" name="password" type="password" required minlength="6"
            placeholder="sua senha"
            autocomplete="current-password"
          />
        </div>

        <!-- botão e link -->
        <Button type="submit" class="btn-primary">entrar</Button>
        <a href="#" class="recover-link">recuperar conta</a>

        <!-- feedback -->
        <p id="feedback" class="text-sm mt-2 text-cinza" aria-live="polite"></p>
      </form>
    </section>
  </main>

  <Footer />

  <!-- Script do stub de login -->
  <script is:inline>
    const form = document.getElementById('loginForm');
    const fb   = document.getElementById('feedback');

    form?.addEventListener('submit', (e) => {
      e.preventDefault();

      const emailEl = document.getElementById('email');
      const pwdEl   = document.getElementById('password');

      if (!(emailEl instanceof HTMLInputElement) || !(pwdEl instanceof HTMLInputElement)) {
        if (fb) fb.textContent = 'erro no formulário. tente novamente';
        return;
      }

      const email = emailEl.value.trim();
      const pwd   = pwdEl.value;

      if (!email || !pwd || pwd.length < 6) {
        if (fb) fb.textContent = 'verifique seu email e senha (mín. 6 caracteres)';
        return;
      }

      localStorage.setItem('auth', '1');
      localStorage.setItem('userEmail', email);

      if (fb) fb.textContent = 'bem-vindo! redirecionando…';
      setTimeout(() => { window.location.href = import.meta.env.BASE_URL; }, 500);
    });
  </script>
</Layout>
