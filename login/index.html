<!DOCTYPE html><html lang="pt-br"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>entrar - espaço origens</title><meta name="description" content="acesse sua conta em espaço origens para acompanhar pedidos e ver favoritos."><meta name="theme-color" content="#B75E3C"><link rel="icon" href="/espaco-origens-site/favicon.png"><base href="/espaco-origens-site/"><!-- carrega env.js sem document.write --><script>
      (function () {
        var base = document.querySelector('base')?.getAttribute('href') || '/';
        if (!base.endsWith('/')) base += '/';
        var s = document.createElement('script');
        s.src = base + 'env.js';
        s.defer = true;
        document.head.appendChild(s);
      })();
    </script><link rel="stylesheet" href="/espaco-origens-site/_astro/contato.8Zy0n5LM.css"></head> <body class="min-h-dvh bg-creme text-marrom antialiased">  <header class="sticky top-0 z-50 border-b border-areia/70 bg-creme/80 backdrop-blur"> <nav class="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between"> <!-- logo + wordmark --> <a href="/espaco-origens-site/" class="flex items-center gap-2"> <img src="/espaco-origens-site/images/logo.png" alt="Espaço Origens" class="h-9 w-9 rounded-full" width="38" height="38"> <span class="lowercase font-medium tracking-wide text-marrom">espaço origens</span> </a> <!-- menu desktop --> <div class="hidden md:flex items-center gap-1"> <a href="/espaco-origens-site/" class="navlink px-3 py-2 rounded-xl transition-colors lowercase navlink-idle "> início </a> <a href="/espaco-origens-site/sobre" class="navlink px-3 py-2 rounded-xl transition-colors lowercase navlink-idle "> sobre </a> <a href="/espaco-origens-site/contato" class="navlink px-3 py-2 rounded-xl transition-colors lowercase navlink-idle "> contato </a> </div> <!-- auth (desktop) --> <div class="hidden md:flex items-center"> <div id="loginDesk"> <a href="/espaco-origens-site/login" class="btn inline-flex items-center justify-center rounded-2xl font-medium lowercase transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-terracota/60 disabled:opacity-50 disabled:pointer-events-none px-3 py-2 text-sm !text-white bg-terracota hover:brightness-110 active:translate-y-[1px] ">entrar</a> </div> <div id="logoutDesk" class="hidden"> <button class="btn inline-flex items-center justify-center rounded-2xl font-medium lowercase transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-terracota/60 disabled:opacity-50 disabled:pointer-events-none px-3 py-2 text-sm border border-terracota text-terracota bg-creme hover:bg-areia/50 active:translate-y-[1px] " id="logoutBtnDesk">sair</button> </div> </div> <!-- hambúrguer --> <button id="menuBtn" type="button" class="md:hidden inline-flex items-center justify-center h-10 w-10 rounded-xl text-marrom ring-1 ring-terracota/50 bg-creme/90 hover:bg-areia/60 relative z-[60] pointer-events-auto touch-manipulation" aria-label="abrir menu" aria-controls="mobileNav" aria-expanded="false"> <svg viewBox="0 0 24 24" class="h-6 w-6" aria-hidden="true"> <path d="M4 7h16M4 12h16M4 17h16" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"></path> </svg> </button> </nav> <!-- menu mobile --> <div id="mobileNav" class="md:hidden hidden border-t border-areia/70 bg-creme" aria-hidden="true"> <div class="max-w-6xl mx-auto px-4 py-3 flex flex-col gap-2"> <a href="/espaco-origens-site/" class="navlink px-3 py-2 rounded-xl transition-colors lowercase navlink-idle "> início </a> <a href="/espaco-origens-site/sobre" class="navlink px-3 py-2 rounded-xl transition-colors lowercase navlink-idle "> sobre </a> <a href="/espaco-origens-site/contato" class="navlink px-3 py-2 rounded-xl transition-colors lowercase navlink-idle "> contato </a> <div id="loginMob"> <a href="/espaco-origens-site/login" class="btn inline-flex items-center justify-center rounded-2xl font-medium lowercase transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-terracota/60 disabled:opacity-50 disabled:pointer-events-none px-5 py-3 text-base !text-white bg-terracota hover:brightness-110 active:translate-y-[1px] mt-1">entrar</a> </div> <div id="logoutMob" class="hidden"> <button class="btn inline-flex items-center justify-center rounded-2xl font-medium lowercase transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-terracota/60 disabled:opacity-50 disabled:pointer-events-none px-5 py-3 text-base border border-terracota text-terracota bg-creme hover:bg-areia/50 active:translate-y-[1px] mt-1" id="logoutBtnMob">sair</button> </div> </div> </div> <script type="module">
    // caminho do cliente público levando em conta <base href>
    const base = document.querySelector('base')?.getAttribute('href') || '/';
    const AUTH_PATH = (base.replace(/\/+$/, '')) + '/scripts/auth-client.js';

    const btn = document.getElementById('menuBtn');
    const nav = document.getElementById('mobileNav');

    let isOpen = false;
    let suppressNextDocClick = false;
    let currentUser = null;
    let authMod = null; // mantemos o módulo em memória

    function setOpen(v) {
      isOpen = v;
      if (!nav || !btn) return;
      nav.classList.toggle('hidden', !v);
      btn.setAttribute('aria-expanded', String(v));
      nav.setAttribute('aria-hidden', String(!v));
    }
    function toggle() { setOpen(!isOpen); }

    const onBtnActivate = (e) => { e.preventDefault(); suppressNextDocClick = true; toggle(); };
    btn?.addEventListener('click', onBtnActivate);
    btn?.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); onBtnActivate(e); }
    });

    document.addEventListener('click', (e) => {
      if (!isOpen) return;
      if (suppressNextDocClick) { suppressNextDocClick = false; return; }
      const t = e.target; if (!(t instanceof Element)) return;
      if (!nav.contains(t) && !btn.contains(t)) setOpen(false);
    });

    nav?.addEventListener('click', (e) => {
      const t = e.target; if (t instanceof Element && t.closest('a')) setOpen(false);
    });

    const mq = window.matchMedia('(min-width: 768px)');
    (mq.addEventListener
      ? mq.addEventListener('change', (ev) => ev.matches && setOpen(false))
      : (mq.onchange = (ev) => ev.matches && setOpen(false)));

    function syncAuthUI() {
      const loginDesk = document.getElementById('loginDesk');
      const logoutDesk = document.getElementById('logoutDesk');
      const loginMob  = document.getElementById('loginMob');
      const logoutMob = document.getElementById('logoutMob');
      const logged = !!currentUser;
      loginDesk?.classList.toggle('hidden', logged);
      logoutDesk?.classList.toggle('hidden', !logged);
      loginMob?.classList.toggle('hidden', logged);
      logoutMob?.classList.toggle('hidden', !logged);
    }

    async function waitForEnv(ms = 3000) {
      const t0 = performance.now();
      while (!window.__ENV) {
        if (performance.now() - t0 > ms) break;
        await new Promise(r => setTimeout(r, 25));
      }
    }

    async function detectUserFromToken() {
      try {
        let token = null;
        for (const k of Object.keys(localStorage)) {
          try {
            const j = JSON.parse(localStorage.getItem(k));
            if (j?.access_token) { token = j.access_token; break; }
            if (j?.currentSession?.access_token) { token = j.currentSession.access_token; break; }
          } catch {}
        }
        if (!token) return null;
        const baseUrl = (window.__ENV?.PUBLIC_SUPABASE_URL || '').replace(/\/$/,'');
        const apikey = window.__ENV?.PUBLIC_SUPABASE_ANON_KEY;
        if (!baseUrl || !apikey) return null;
        const res = await fetch(baseUrl + '/auth/v1/user', {
          headers: { Authorization: 'Bearer ' + token, apikey }
        });
        if (!res.ok) return null;
        return await res.json();
      } catch { return null; }
    }

    async function loadAuth() {
      if (authMod) return authMod;
      authMod = await import(/* @vite-ignore */ AUTH_PATH);
      return authMod;
    }

    async function initAuth() {
      await waitForEnv();

      try {
        const m = await loadAuth();
        currentUser = await m.getCurrentUser();
      } catch {
        currentUser = null;
      }

      if (!currentUser) {
        currentUser = await detectUserFromToken().catch(() => null);
      }

      syncAuthUI();

      try {
        const m = await loadAuth();
        m.onAuthStateChange((user) => { currentUser = user; syncAuthUI(); });
      } catch {}

      if (localStorage.getItem('justLoggedIn')) {
        localStorage.removeItem('justLoggedIn');
        setTimeout(async () => {
          try {
            const m = await loadAuth();
            currentUser = await m.getCurrentUser();
          } catch { currentUser = null; }
          if (!currentUser) currentUser = await detectUserFromToken().catch(() => null);
          syncAuthUI();
        }, 800);
      }
    }

    async function doLogout() {
      try {
        const m = await loadAuth();
        await m.signOut?.();
        currentUser = null;
        syncAuthUI();
        const hrefBase = document.querySelector('base')?.getAttribute('href') || '/';
        const home = hrefBase.replace(/\/+$/, '');
        if (!location.pathname.startsWith(home)) location.href = home + '/';
        setOpen(false);
      } catch (error) {
        console.error('[Header] Erro ao fazer logout:', error);
      }
    }

    document.getElementById('logoutBtnDesk')?.addEventListener('click', doLogout);
    document.getElementById('logoutBtnMob')?.addEventListener('click', doLogout);

    initAuth();
  </script> </header> <main class="flex items-center justify-center min-h-[calc(85vh-8rem)] px-4 py-12"> <section class="w-full max-w-md bg-areia/40 border border-areia/70 rounded-2xl shadow-sm p-6"> <h1 class="text-2xl lowercase text-marrom mb-2">entrar</h1> <p class="text-marrom/80 mb-4 text-sm">
use seu email e senha. você poderá acompanhar pedidos e ver suas obras favoritas.
</p> <form id="loginForm" novalidate> <div> <label for="email">email</label> <input id="email" name="email" type="email" required placeholder="nome@exemplo.com" autocomplete="email"> </div> <div> <label for="password">senha</label> <input id="password" name="password" type="password" required minlength="6" placeholder="sua senha" autocomplete="current-password"> </div> <button class="btn inline-flex items-center justify-center rounded-2xl font-medium lowercase transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-terracota/60 disabled:opacity-50 disabled:pointer-events-none px-5 py-3 text-base !text-white bg-terracota hover:brightness-110 active:translate-y-[1px] btn-primary" type="submit">entrar</button> <a href="?signup=true" class="recover-link">criar conta</a> <a href="#" class="recover-link">recuperar conta</a> <p id="feedback" class="text-sm mt-2 text-cinza" aria-live="polite"></p> </form> </section> </main> <footer class="mt-16 border-t border-areia/70"> <div class="max-w-6xl mx-auto px-4 py-8 text-sm text-cinza"> <div class="flex flex-col sm:flex-row items-center justify-between gap-3"> <p>© 2025 espaço origens</p> <div class="flex gap-4"> <a href="https://instagram.com/espaco_origens" target="_blank" rel="noopener" class="hover:text-marrom">instagram</a> <a href="https://wa.me/5521981869391" target="_blank" rel="noopener" class="hover:text-marrom">whatsapp</a> </div> </div> </div> </footer> <script type="module">
    // @ts-nocheck

    const form = document.getElementById('loginForm');
    const fb = document.getElementById('feedback');

    const isSignUp =
      new URLSearchParams(window.location.search).get('signup') === 'true' ||
      window.location.search.includes('signup=true');

    // Ajusta UI quando for cadastro
    if (isSignUp) {
      const title = document.querySelector('h1');
      const button = document.querySelector('button[type="submit"]');
      const firstRecover = document.querySelector('.recover-link');
      if (title) title.textContent = 'criar conta';
      if (button) button.textContent = 'criar conta';
      if (firstRecover) firstRecover.textContent = 'já tem conta? entrar';
    }

    function setFeedback(text) {
      if (fb) fb.textContent = text;
    }

    function mapSignupErrorMessage(msg) {
      const m = String(msg || '').toLowerCase();
      if (m.includes('already registered') || m.includes('already exists') || m.includes('duplicate')) {
        return 'usuário já existe. faça login ou recupere a senha';
      }
      if (m.includes('invalid email')) return 'email inválido. verifique e tente novamente';
      if (m.includes('at least')) return 'a senha deve ter pelo menos 6 caracteres';
      if (m.includes('over_email_send_rate_limit') || m.includes('rate limit'))
        return 'muitas tentativas. aguarde alguns minutos';
      if (m.includes('unexpected_failure')) return 'erro temporário. tente novamente em alguns minutos';
      return 'erro ao criar conta. tente novamente';
    }

    function mapLoginErrorMessage(msg) {
      const m = String(msg || '').toLowerCase();
      if (m.includes('invalid login credentials')) return 'email ou senha incorretos';
      if (m.includes('user not confirmed')) return 'confirme seu email antes de entrar';
      if (m.includes('error sending confirmation email'))
        return 'erro ao enviar email de confirmação. tente novamente em alguns minutos';
      if (m.includes('over_email_send_rate_limit') || m.includes('rate limit'))
        return 'muitas tentativas. aguarde alguns minutos';
      if (m.includes('unexpected_failure')) return 'erro temporário. tente novamente em alguns minutos';
      return 'erro ao fazer login. tente novamente';
    }

    async function handleSubmit(e) {
      e.preventDefault();

      const emailEl = document.getElementById('email');
      const pwdEl = document.getElementById('password');

      const email = String(emailEl && emailEl.value || '').trim();
      const pwd = String(pwdEl && pwdEl.value || '');

      if (!email || !pwd || pwd.length < 6) {
        setFeedback('verifique seu email e senha (mín. 6 caracteres)');
        return;
      }

      try {
        setFeedback(isSignUp ? 'criando conta...' : 'entrando...');

        if (isSignUp) {
          const { signUp } = await import('../lib/auth.ts');
          const res = await signUp(email, pwd); // { data, error }

          if (res && res.error) {
            setFeedback(mapSignupErrorMessage(res.error.message || res.error));
            return;
          }

          // Heurística: se não houve error, mas também não veio user,
          // é muito provável que o e-mail já exista/confirmado.
          const user = res && res.data && res.data.user;
          if (!user) {
            setFeedback('usuário já existe. faça login ou recupere a senha');
            return;
          }

          setFeedback('conta criada! verifique seu email para confirmar.');
          return;
        }

        // Login
        const { signIn } = await import('../lib/auth.ts');
        await signIn(email, pwd);

        setFeedback('bem-vindo! redirecionando…');
        localStorage.setItem('justLoggedIn', '1');
        setTimeout(() => {
          window.location.href = import.meta.env.BASE_URL;
        }, 1000);
      } catch (err) {
        const message = (err && err.message) ? err.message : err;
        if (isSignUp) setFeedback(mapSignupErrorMessage(message));
        else setFeedback(mapLoginErrorMessage(message));
      }
    }

    form && form.addEventListener('submit', handleSubmit);

    // Links auxiliares
    const links = document.querySelectorAll('.recover-link');

    // Alternar login/signup
    if (links[0]) {
      links[0].addEventListener('click', (e) => {
        e.preventDefault();
        if (isSignUp) {
          window.location.href = window.location.pathname;
        } else {
          const url = new URL(window.location.href);
          url.searchParams.set('signup', 'true');
          window.location.href = url.toString();
        }
      });
    }

    // Recuperar senha
    if (links[1]) {
      links[1].addEventListener('click', async (e) => {
        e.preventDefault();

        const emailEl = document.getElementById('email');
        const email = String(emailEl && emailEl.value || '');

        if (!email) {
          setFeedback('digite seu email primeiro');
          return;
        }

        try {
          setFeedback('enviando email de recuperação...');
          const { resetPassword } = await import('../lib/auth.ts');
          await resetPassword(email);
          setFeedback('email de recuperação enviado!');
        } catch (err) {
          const message = (err && err.message) ? err.message : err;
          if (String(message).toLowerCase().includes('rate limit')) {
            setFeedback('muitas tentativas. aguarde alguns minutos');
          } else {
            setFeedback('erro ao enviar email de recuperação');
          }
        }
      });
    }
  </script>  </body></html>